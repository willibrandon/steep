# YAML Configuration Schema for Steep
# Location: ~/.config/steep/config.yaml or path specified by STEEP_CONFIG env var

# Database connection configuration
connection:
  # PostgreSQL host (default: localhost)
  # Can be overridden by STEEP_CONNECTION_HOST or PGHOST
  host: localhost

  # PostgreSQL port (default: 5432)
  # Can be overridden by STEEP_CONNECTION_PORT or PGPORT
  port: 5432

  # Database name (default: postgres)
  # Can be overridden by STEEP_CONNECTION_DATABASE or PGDATABASE
  database: postgres

  # Database user (default: OS username)
  # Can be overridden by STEEP_CONNECTION_USER or PGUSER
  user: brandon

  # Command to retrieve password from external password manager
  # Examples:
  #   - "pass show postgres/local"  (Unix pass)
  #   - "security find-generic-password -s postgres -w"  (macOS Keychain)
  #   - "1password get item PostgreSQL --field password"  (1Password CLI)
  # If not set, falls back to PGPASSWORD env var or interactive prompt
  # NO PLAINTEXT PASSWORDS - use password_command or environment variables only
  password_command: "pass show postgres/local"

  # SSL mode: disable, prefer, require (default: prefer)
  # prefer: Try SSL, fall back to non-SSL if unavailable
  # require: Require SSL connection, fail if unavailable
  sslmode: prefer

  # Maximum connections in pool (default: 10)
  # Higher values support more concurrent queries but consume more database resources
  pool_max_conns: 25

  # Minimum connections in pool (default: 2)
  # Keeps pool warm for faster query execution
  pool_min_conns: 5

# User interface configuration
ui:
  # Color theme: dark, light (default: dark)
  theme: dark

  # Status bar refresh interval (default: 1s)
  # Minimum: 100ms, Maximum: 60s
  # Format: Go duration string (e.g., "1s", "500ms", "2s")
  refresh_interval: 1s

  # Date/time format for display (default: "2006-01-02 15:04:05")
  # Uses Go time format syntax
  # Examples:
  #   - "2006-01-02 15:04:05"  (YYYY-MM-DD HH:MM:SS)
  #   - "Jan 2 15:04:05"       (Mon DD HH:MM:SS)
  #   - "15:04:05"             (HH:MM:SS only)
  date_format: "2006-01-02 15:04:05"

# Log viewer configuration
logs:
  # How to read PostgreSQL log files: auto, filesystem, pg_read_file (default: auto)
  # - auto: Try filesystem first, fall back to pg_read_file
  # - filesystem: Read logs directly from disk (requires local access)
  # - pg_read_file: Read logs via SQL (works over network, requires superuser or pg_read_server_files role)
  access_method: auto

# Alert system configuration
alerts:
  # Master switch to enable/disable alerting (default: true)
  enabled: true

  # How long to keep alert history (default: 720h = 30 days)
  # Format: Go duration string (e.g., "720h", "168h" for 1 week)
  history_retention: 720h

  # Alert rules - each rule monitors a metric against thresholds
  # Rules are evaluated on each refresh cycle (ui.refresh_interval)
  rules:
    # Example: Alert on high connection usage
    - name: high_connections
      metric: active_connections
      operator: ">"
      warning: 80      # Warn when > 80 connections
      critical: 95     # Critical when > 95 connections
      enabled: true

    # Example: Alert on low cache hit ratio
    - name: low_cache_hit
      metric: cache_hit_ratio
      operator: "<"
      warning: 0.95    # Warn when < 95% (0.95)
      critical: 0.90   # Critical when < 90% (0.90)
      enabled: true

    # Example: Alert on high TPS (potential load spike)
    # - name: high_tps
    #   metric: tps
    #   operator: ">"
    #   warning: 1000
    #   critical: 5000
    #   enabled: false

    # Example: Expression-based rule (connection utilization ratio)
    # - name: connection_saturation
    #   metric: active_connections / max_connections
    #   operator: ">"
    #   warning: 0.8    # Warn at 80% utilization
    #   critical: 0.95  # Critical at 95% utilization
    #   enabled: true

  # Available metrics:
  #   active_connections  - Number of active database connections
  #   max_connections     - Maximum allowed connections (from pg_settings)
  #   cache_hit_ratio     - Buffer cache hit ratio (0-1, e.g., 0.99 = 99%)
  #   tps                 - Transactions per second
  #   database_size       - Database size in bytes
  #   replication_lag_bytes       - Replication lag in bytes
  #   longest_transaction_seconds - Duration of longest running transaction
  #   idle_in_transaction_seconds - Duration of longest idle-in-transaction
  #
  # Operators: >, <, >=, <=, ==, !=
  # Expressions: Metrics can be combined with +, -, *, / operators

# Debug mode (default: false)
# Can be overridden by STEEP_DEBUG=1 environment variable or -debug flag
# When enabled, logs at Debug level
debug: false

# Log file path (default: ~/.config/steep/steep.log)
# Can be overridden by STEEP_LOG_FILE environment variable
# Set to empty string to use default location
log_file: ""
